fix(graphql): structured transaction query limits by amnn ¬∑ Pull Request #24319 ¬∑ MystenLabs/sui ¬∑ GitHub



[Skip to content](#start-of-content)







## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMystenLabs%2Fsui%2Fpull%2F24319)

Appearance settings

Search or jump to...


# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.


Include my email address so I can be contacted

Cancel
 Submit feedback





# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

Cancel
 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMystenLabs%2Fsui%2Fpull%2F24319)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=MystenLabs%2Fsui)

Appearance settings

Resetting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.
 


Dismiss alert

{{ message }}

[MystenLabs](/MystenLabs) 
/
**[sui](/MystenLabs/sui)**
Public

* [Notifications](/login?return_to=%2FMystenLabs%2Fsui) You must be signed in to change notification settings
* [Fork
  11.7k](/login?return_to=%2FMystenLabs%2Fsui)
* [Star
   7.5k](/login?return_to=%2FMystenLabs%2Fsui)

# fix(graphql): structured transaction query limits #24319

New issue

 

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

[Sign up for GitHub](/signup?return_to=%2FMystenLabs%2Fsui%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FMystenLabs%2Fsui%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

Merged

[amnn](/amnn)
merged 1 commit into
[main](/MystenLabs/sui/tree/main "MystenLabs/sui:main")
from
[amnn/gql-tx-limits](/MystenLabs/sui/tree/amnn/gql-tx-limits "MystenLabs/sui:amnn/gql-tx-limits")








Nov 18, 2025

Merged

# [fix(graphql): structured transaction query limits](#top) #24319

[amnn](/amnn)
merged 1 commit into
[main](/MystenLabs/sui/tree/main "MystenLabs/sui:main")
from
[amnn/gql-tx-limits](/MystenLabs/sui/tree/amnn/gql-tx-limits "MystenLabs/sui:amnn/gql-tx-limits")








Nov 18, 2025

### Uh oh!

There was an error while loading. Please reload this page.

## Conversation

This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

[Show hidden characters]({{ revealButtonHref }})








[![@amnn](https://avatars.githubusercontent.com/u/332275?s=80&v=4)](/amnn)

Copy link

Contributor

### @amnn **[amnn](/amnn)** commented [Nov 18, 2025](#issue-3638530281)

## Description

Update the query limits checker to be able to account for transactions given as structured payloads instead of just raw bytes.

## Test plan

New unit tests:

```move
sui-indexer-alt-graphql$ cargo nextest run
```

And testing the following repro, on a local network:

```move
sui$ cargo run -p sui -- start --with-graphql --force-regenesis
```

And then execute the following query on `http://localhost:9125/graphql`:

```move
fragment BaseObject on Object {
  version
  object_digest: digest
  object_id: address
}

fragment ObjectStandard on Object {
  bcs: objectBcs
  ...BaseObject
  owner {
    ... on AddressOwner {
      address_id: address {
        address
      }
      obj_owner_kind: __typename
    }
    ... on Shared {
      initial_version: initialSharedVersion
      obj_owner_kind: __typename
    }
    ... on Immutable {
      obj_owner_kind: __typename
    }
    ... on ObjectOwner {
      parent_id: address {
        address
      }
      obj_owner_kind: __typename
    }
  }
  storage_rebate: storageRebate
  prior_transaction: previousTransaction {
    previous_transaction_digest: digest
  }
  as_move_content: asMoveObject {
    has_public_transfer: hasPublicTransfer
    as_object: contents {
      content: json
      object_type_repr: type {
        object_type: repr
      }
    }
  }
  as_move_package: asMovePackage {
    bcs: moduleBcs
  }
}

fragment GasSummary on GasCostSummary {
  computationCost
  storageCost
  storageRebate
  nonRefundableStorageFee
}

fragment TxEffects on TransactionEffects {
  status
  executionError {
    abortCode
    sourceLineNumber
    instructionOffset
    identifier
    constant
    message
  }
  timestamp
  balanceChanges {
    nodes {
      coinType {
        coin_type: repr
      }
      balance_change: amount
      change_to: owner {
        object_id: address
      }
    }
  }
  gasEffects {
    gasObject {
      gas_object_id: address
    }
    gasSummary {
      ...GasSummary
    }
  }
  objectChanges {
    nodes {
      address: address
      deleted: idDeleted
      created: idCreated
      input_state: inputState {
        ...ObjectStandard
      }
      output_state: outputState {
        ...ObjectStandard
      }
    }
  }
  checkpoint {
    sequenceNumber
    networkTotalTransactions
    timestamp
    epoch {
      epochId
      startTimestamp
      endTimestamp
    }
  }
  events {
    nodes {
      sequenceNumber
      timestamp
      contents {
        json
      }
      transactionModule {
        package {
          version
          package_id: address
        }
        module_name: name
      }
    }
  }
}

{
  dryRun: simulateTransaction(
    transaction: {kind: {programmable_transaction: {inputs: [{kind: "PURE", pure: "qeLbOF8FXMAhWjzeJot2JwU1uUQ4B1FPGDvoaSbCGfQ="}], commands: [{publish: {modules: ["oRzrCwcAAAUOAQAYAhhQA2jpAQTRAiIF8wKxAwekBqMHCMcNYAanDh8Kxg5gC6YPAgyoD/wDDaQTBBGoExoTwhMCAFQBUwFdAhcCKwIvAjICUgJeAmACYQJjAAoDAAAJBAAAAAcAAA4MAAAHBwEBAAAMBAAACwgAAA0EAAEIBwEAAAIRBwADAQQBAAEEAgwBAAEHBAcABxMEAAgQAgAKEgIACxQHAgEAAAAALAABAABbAgMAACUEAwAAIAUDAAAmBgMAAB8HAwAAKggDAAApCQMAACcKAwAAGwsDAAAeDAMAACINAwAAIw4DAAAkDwMAACgQAwAAXxESAQAAHRMDAABEABQAABwVAwEDAEkAAwAALQADAAAhFhcAABoYAwAAVRkDAABFGhsAATQ5LgEAAUwxFwEAAVEDIwEAAmIgIQADTTY3AQADXDUfAQADZDQfAQADZQMfAQAEGDM0AQAEQzo7AQAFFiwDAgcEBTMqFwEHBjAuAwEDBy4dAwAHUAAdAAlgLwMBCApZJBQACzEDKAIBACAeGyIbJionJCAjKyUtKAEoMBowIR4eHh0eGjcZNx8eIh4BBwgPAQgGAQcIBgAGDQ4DBA8HCA8GCwgBDQsIAQ4LCAEDCwgBBAsIAQ8HCA8GCg0KDgoDCgQKDwcIDwYLCAEKDQsIAQoOCwgBCgMLCAEKBAsIAQoPBwgPAgoCBwgPAgsIAQoCBwgPAgoKCgIHCA8CCgUHCA8CCggMBwgPAgYICQcIDwILCAEICQcIDwIKCAkHCA8CCgsIAQgJBwgPAgoLCwEJAAcIDwEKCwsBCQACAQcIDwEFCgECDwgJCwgBCAkKAgoICQYIBQoLBAEJAAcIDwIHCwgBCAMHCA8BAQIIAwcIDwMHCAYHCwsBCA4HCA8DBwgGBwsIAQMHCA8BCwsBCA4FCA0LCgEIDggJCAUIBgEIDQEIDgELCgEJAAEKAgEICQECAQsIAQkAAQYIDwEKCAcBCAcCAwMBCxACCQAJAQEIAgIGCA0JAAIKAgIDBwgNCQAJAQEIAAEJAAIJAAUBCAMBBgsIAQkAAQcLCgEIDgEHCwsBCQABBwsKAQkAAgcLCgEJAAMCBwsKAQkACwoBCQABAwILCgEIDgMBBwsIAQkAAgsKAQkABwgPAQsLAQkABUFLaW5kB0JhbGFuY2UEQ29pbgZESVJFQ1QCSUQDTVRPA01UUwdNYXlUeXBlBk9wdGlvbghQYXJtRW51bQlQYXJtRXZlbnQKUGFybU9iamVjdAtQYXJtU2NhbGFycwpQYXJtU3RydWN0BlBob25leQNSR0IDU1VJBlN0cmluZwlUeENvbnRleHQDVUlEBlZlY01hcARhX3U4A2FkZAdiYWxhbmNlC2JhbGFuY2VfbXV0BGJsdWULYnVybl9waG9uZXkRY2hlY2tfYWRkcmVzc192ZWMJY2hlY2tfYWxsCmNoZWNrX2Jvb2wMY2hlY2tfaWRfdmVjG2NoZWNrX29wdGlvbmFsX3VpbnRfdmVjdG9ycxRjaGVja19vcHRpb25hbF91aW50cwxjaGVja19waG9uZXkMY2hlY2tfc3RyaW5nE2NoZWNrX3N0cmluZ19vcHRpb24QY2hlY2tfc3RyaW5nX3ZlYwtjaGVja191aW50cxNjaGVja191aW50c192ZWN0b3JzEWNoZWNrX3ZlY19kZWVwX3U4F2NoZWNrX3ZlY19vcHRpb25fc3RyaW5nFWNoZWNrX3ZlY19vcHRpb25hbF91OAxjaGVja192ZWNfdTgEY29pbhJjcmVhdGVfcGFybV9vYmplY3QNY3JlYXRlX3Bob25leQZkZWxldGUNZHluYW1pY19maWVsZARlbWl0BWVtcHR5BWV2ZW50B2V4aXN0c18HZXh0cmFjdAlmX2FkZHJlc3MGZl9lbnVtDWZfbmVzdF92ZWN0b3IGZl9vX3U4CmZfb3B0aW9uYWwGZl91MTI4BWZfdTE2BmZfdTI1NgVmX3UzMgVmX3U2NARmX3U4CWZfdmVjX21hcAhmX3ZlY3RvcgNmb28MZnJvbV9iYWxhbmNlCmdldF9zZW5kZXILZ2V0X3NlcnZpY2UFZ3JlZW4CaWQFaW5kZXgEaW5pdAdpbm5hcmRzBWlubmVyB2lzX3NvbWUEam9pbgZteW5hbWUGbXl0eXBlA25ldwRub25lBm9iamVjdAZvcHRpb24FcGFybXMLcGF5X3NlcnZpY2UEcG9zMARwb3MxA3JlZAZzZW5kZXIHc2VydmljZRJzZXRfb2JqZWN0X3ZlcnNpb24Fc3BsaXQGc3RyaW5nA3N1aQhzd2FwX2FfYgh0cmFuc2Zlcgp0eF9jb250ZXh0BHV0ZjgHdmVjX21hcAx3aXRoZHJhd19hbGwEemVybwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgMIQEIPAAAAAAACAQEKAgQDZm9vCgIIB3ZlcnNpb24AAgFCAgICARUCAwIBRwgNBAIBSwkABQINPwI7DT0OPgM6BDwPOAsIAQI1BUEKAjcKCggHOQsIAQgHQAsQAgMDNggBBgIFRwgNSggFWgsKAQgOTggJTwsEAQgCBwIBSAIDKQABAAAcJwoAEScMATgADAIHAhEcDAMxAEgAAEkAAAAABgAAAAAAAAAAMgAAAAAAAAAAAAAAAAAAAABKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AQsALhEpQCIAAAAAAAAAAEAlAAAAAAAAAAA4AjgDMQBOABIEDAQLAQsECwILAzEPEgE5ABIFDAUNBREBCwUCAAEAAAADDgoAEAAHAzgEBAgLAAEFDQsADwAHAwcBOAUCAAIBAAADBDEAEgA4BgIAAwEAAAMEMQESADgGAgAEAQAAAwECAAUBAAADAQIABgEAAAMBAgAHAQAAAwECAAgBAAADAQIACQEAAAMBAgAKAQAAAwECAAsBAAADAQIADAEAAAMBAgANAQAAAwECAA4BAAADAQIADwEAAAMCCwACABABAAADAQIAEQEAAAMECwAuESkCABIBAAADAQIAEwAAAAMHCgARAAsALhEpOAcCABQBAAADCAoAEScSAgsALhEpOAgCABUBAAAXCwsALjgJBAcIDAIFCQkMAgsCAgAWAQAAAwQLABMCESYCABcBAAAyDQoAEQELATgKDAMLAA8BCwMHADgLOAwBAgAYAQAAOBkKABEBCgEuOA0EDwsBOA4MBAsADwELBDgLDAMFFQsBAQsADwE4DwwDCwMLAjgQAgAFAAUCAQIEAwFWAg8DWAJGAhkCBQJWAlcCBgFWCAcAAAA="], dependencies: ["0x000000000000000000000000000000000000000000000000000000000000000b", "0x0000000000000000000000000000000000000000000000000000000000000001", "0x0000000000000000000000000000000000000000000000000000000000000002", "0x0000000000000000000000000000000000000000000000000000000000000003"]}}, {transfer_objects: {objects: [{kind: "RESULT", result: 0}], address: {kind: "INPUT", input: 0}}}]}}, sender: "0xa9e2db385f055cc0215a3cde268b76270535b9443807514f183be86926c219f4"}
  ) {
    error
    results: outputs {
      returnValues {
        value {
          type {
            repr
          }
          bcs
        }
      }
    }
    transactionBlock: effects {
      ...TxEffects
    }
  }
}
```

---

## Release notes

Check each box that your changes affect. If none of the boxes relate to your changes, release notes aren't required.

For each box you select, include information after the relevant heading that describes the impact of your changes that a user might notice and any actions they must take to implement updates.

* Protocol:
* Nodes (Validators and Full nodes):
* gRPC:
* JSON-RPC:
* GraphQL: Fixes a bug where the transaction payloads that were part of `simulateTransaction` calls were incorrectly classified as part of the query payload (and therefore subject to a lower payload size limit).
* CLI:
* Rust SDK:
* Indexing Framework:

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

All reactions

[![@amnn](https://avatars.githubusercontent.com/u/332275?s=40&v=4)](/amnn)

`fix(graphql): structured transaction query limits`

 ‚Ä¶

`fcb3b65`

```move
## Description

Update the query limits checker to be able to account for transactions
given as structured payloads instead of just raw bytes.

## Test plan

New unit tests:

```
sui-indexer-alt-graphql$ cargo nextest run
```

And testing the following repro, on a local network:

```
sui$ cargo run -p sui -- start --with-graphql --force-regenesis
```

And then execute the following query on `http://localhost:9125/graphql`:

```graphql
fragment BaseObject on Object {
  version
  object_digest: digest
  object_id: address
}

fragment ObjectStandard on Object {
  bcs: objectBcs
  ...BaseObject
  owner {
    ... on AddressOwner {
      address_id: address {
        address
      }
      obj_owner_kind: __typename
    }
    ... on Shared {
      initial_version: initialSharedVersion
      obj_owner_kind: __typename
    }
    ... on Immutable {
      obj_owner_kind: __typename
    }
    ... on ObjectOwner {
      parent_id: address {
        address
      }
      obj_owner_kind: __typename
    }
  }
  storage_rebate: storageRebate
  prior_transaction: previousTransaction {
    previous_transaction_digest: digest
  }
  as_move_content: asMoveObject {
    has_public_transfer: hasPublicTransfer
    as_object: contents {
      content: json
      object_type_repr: type {
        object_type: repr
      }
    }
  }
  as_move_package: asMovePackage {
    bcs: moduleBcs
  }
}

fragment GasSummary on GasCostSummary {
  computationCost
  storageCost
  storageRebate
  nonRefundableStorageFee
}

fragment TxEffects on TransactionEffects {
  status
  executionError {
    abortCode
    sourceLineNumber
    instructionOffset
    identifier
    constant
    message
  }
  timestamp
  balanceChanges {
    nodes {
      coinType {
        coin_type: repr
      }
      balance_change: amount
      change_to: owner {
        object_id: address
      }
    }
  }
  gasEffects {
    gasObject {
      gas_object_id: address
    }
    gasSummary {
      ...GasSummary
    }
  }
  objectChanges {
    nodes {
      address: address
      deleted: idDeleted
      created: idCreated
      input_state: inputState {
        ...ObjectStandard
      }
      output_state: outputState {
        ...ObjectStandard
      }
    }
  }
  checkpoint {
    sequenceNumber
    networkTotalTransactions
    timestamp
    epoch {
      epochId
      startTimestamp
      endTimestamp
    }
  }
  events {
    nodes {
      sequenceNumber
      timestamp
      contents {
        json
      }
      transactionModule {
        package {
          version
          package_id: address
        }
        module_name: name
      }
    }
  }
}

{
  dryRun: simulateTransaction(
    transaction: {kind: {programmable_transaction: {inputs: [{kind: "PURE", pure: "qeLbOF8FXMAhWjzeJot2JwU1uUQ4B1FPGDvoaSbCGfQ="}], commands: [{publish: {modules: ["oRzrCwcAAAUOAQAYAhhQA2jpAQTRAiIF8wKxAwekBqMHCMcNYAanDh8Kxg5gC6YPAgyoD/wDDaQTBBGoExoTwhMCAFQBUwFdAhcCKwIvAjICUgJeAmACYQJjAAoDAAAJBAAAAAcAAA4MAAAHBwEBAAAMBAAACwgAAA0EAAEIBwEAAAIRBwADAQQBAAEEAgwBAAEHBAcABxMEAAgQAgAKEgIACxQHAgEAAAAALAABAABbAgMAACUEAwAAIAUDAAAmBgMAAB8HAwAAKggDAAApCQMAACcKAwAAGwsDAAAeDAMAACINAwAAIw4DAAAkDwMAACgQAwAAXxESAQAAHRMDAABEABQAABwVAwEDAEkAAwAALQADAAAhFhcAABoYAwAAVRkDAABFGhsAATQ5LgEAAUwxFwEAAVEDIwEAAmIgIQADTTY3AQADXDUfAQADZDQfAQADZQMfAQAEGDM0AQAEQzo7AQAFFiwDAgcEBTMqFwEHBjAuAwEDBy4dAwAHUAAdAAlgLwMBCApZJBQACzEDKAIBACAeGyIbJionJCAjKyUtKAEoMBowIR4eHh0eGjcZNx8eIh4BBwgPAQgGAQcIBgAGDQ4DBA8HCA8GCwgBDQsIAQ4LCAEDCwgBBAsIAQ8HCA8GCg0KDgoDCgQKDwcIDwYLCAEKDQsIAQoOCwgBCgMLCAEKBAsIAQoPBwgPAgoCBwgPAgsIAQoCBwgPAgoKCgIHCA8CCgUHCA8CCggMBwgPAgYICQcIDwILCAEICQcIDwIKCAkHCA8CCgsIAQgJBwgPAgoLCwEJAAcIDwEKCwsBCQACAQcIDwEFCgECDwgJCwgBCAkKAgoICQYIBQoLBAEJAAcIDwIHCwgBCAMHCA8BAQIIAwcIDwMHCAYHCwsBCA4HCA8DBwgGBwsIAQMHCA8BCwsBCA4FCA0LCgEIDggJCAUIBgEIDQEIDgELCgEJAAEKAgEICQECAQsIAQkAAQYIDwEKCAcBCAcCAwMBCxACCQAJAQEIAgIGCA0JAAIKAgIDBwgNCQAJAQEIAAEJAAIJAAUBCAMBBgsIAQkAAQcLCgEIDgEHCwsBCQABBwsKAQkAAgcLCgEJAAMCBwsKAQkACwoBCQABAwILCgEIDgMBBwsIAQkAAgsKAQkABwgPAQsLAQkABUFLaW5kB0JhbGFuY2UEQ29pbgZESVJFQ1QCSUQDTVRPA01UUwdNYXlUeXBlBk9wdGlvbghQYXJtRW51bQlQYXJtRXZlbnQKUGFybU9iamVjdAtQYXJtU2NhbGFycwpQYXJtU3RydWN0BlBob25leQNSR0IDU1VJBlN0cmluZwlUeENvbnRleHQDVUlEBlZlY01hcARhX3U4A2FkZAdiYWxhbmNlC2JhbGFuY2VfbXV0BGJsdWULYnVybl9waG9uZXkRY2hlY2tfYWRkcmVzc192ZWMJY2hlY2tfYWxsCmNoZWNrX2Jvb2wMY2hlY2tfaWRfdmVjG2NoZWNrX29wdGlvbmFsX3VpbnRfdmVjdG9ycxRjaGVja19vcHRpb25hbF91aW50cwxjaGVja19waG9uZXkMY2hlY2tfc3RyaW5nE2NoZWNrX3N0cmluZ19vcHRpb24QY2hlY2tfc3RyaW5nX3ZlYwtjaGVja191aW50cxNjaGVja191aW50c192ZWN0b3JzEWNoZWNrX3ZlY19kZWVwX3U4F2NoZWNrX3ZlY19vcHRpb25fc3RyaW5nFWNoZWNrX3ZlY19vcHRpb25hbF91OAxjaGVja192ZWNfdTgEY29pbhJjcmVhdGVfcGFybV9vYmplY3QNY3JlYXRlX3Bob25leQZkZWxldGUNZHluYW1pY19maWVsZARlbWl0BWVtcHR5BWV2ZW50B2V4aXN0c18HZXh0cmFjdAlmX2FkZHJlc3MGZl9lbnVtDWZfbmVzdF92ZWN0b3IGZl9vX3U4CmZfb3B0aW9uYWwGZl91MTI4BWZfdTE2BmZfdTI1NgVmX3UzMgVmX3U2NARmX3U4CWZfdmVjX21hcAhmX3ZlY3RvcgNmb28MZnJvbV9iYWxhbmNlCmdldF9zZW5kZXILZ2V0X3NlcnZpY2UFZ3JlZW4CaWQFaW5kZXgEaW5pdAdpbm5hcmRzBWlubmVyB2lzX3NvbWUEam9pbgZteW5hbWUGbXl0eXBlA25ldwRub25lBm9iamVjdAZvcHRpb24FcGFybXMLcGF5X3NlcnZpY2UEcG9zMARwb3MxA3JlZAZzZW5kZXIHc2VydmljZRJzZXRfb2JqZWN0X3ZlcnNpb24Fc3BsaXQGc3RyaW5nA3N1aQhzd2FwX2FfYgh0cmFuc2Zlcgp0eF9jb250ZXh0BHV0ZjgHdmVjX21hcAx3aXRoZHJhd19hbGwEemVybwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgMIQEIPAAAAAAACAQEKAgQDZm9vCgIIB3ZlcnNpb24AAgFCAgICARUCAwIBRwgNBAIBSwkABQINPwI7DT0OPgM6BDwPOAsIAQI1BUEKAjcKCggHOQsIAQgHQAsQAgMDNggBBgIFRwgNSggFWgsKAQgOTggJTwsEAQgCBwIBSAIDKQABAAAcJwoAEScMATgADAIHAhEcDAMxAEgAAEkAAAAABgAAAAAAAAAAMgAAAAAAAAAAAAAAAAAAAABKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AQsALhEpQCIAAAAAAAAAAEAlAAAAAAAAAAA4AjgDMQBOABIEDAQLAQsECwILAzEPEgE5ABIFDAUNBREBCwUCAAEAAAADDgoAEAAHAzgEBAgLAAEFDQsADwAHAwcBOAUCAAIBAAADBDEAEgA4BgIAAwEAAAMEMQESADgGAgAEAQAAAwECAAUBAAADAQIABgEAAAMBAgAHAQAAAwECAAgBAAADAQIACQEAAAMBAgAKAQAAAwECAAsBAAADAQIADAEAAAMBAgANAQAAAwECAA4BAAADAQIADwEAAAMCCwACABABAAADAQIAEQEAAAMECwAuESkCABIBAAADAQIAEwAAAAMHCgARAAsALhEpOAcCABQBAAADCAoAEScSAgsALhEpOAgCABUBAAAXCwsALjgJBAcIDAIFCQkMAgsCAgAWAQAAAwQLABMCESYCABcBAAAyDQoAEQELATgKDAMLAA8BCwMHADgLOAwBAgAYAQAAOBkKABEBCgEuOA0EDwsBOA4MBAsADwELBDgLDAMFFQsBAQsADwE4DwwDCwMLAjgQAgAFAAUCAQIEAwFWAg8DWAJGAhkCBQJWAlcCBgFWCAcAAAA="], dependencies: ["0x000000000000000000000000000000000000000000000000000000000000000b", "0x0000000000000000000000000000000000000000000000000000000000000001", "0x0000000000000000000000000000000000000000000000000000000000000002", "0x0000000000000000000000000000000000000000000000000000000000000003"]}}, {transfer_objects: {objects: [{kind: "RESULT", result: 0}], address: {kind: "INPUT", input: 0}}}]}}, sender: "0xa9e2db385f055cc0215a3cde268b76270535b9443807514f183be86926c219f4"}
  ) {
    error
    results: outputs {
      returnValues {
        value {
          type {
            repr
          }
          bcs
        }
      }
    }
    transactionBlock: effects {
      ...TxEffects
    }
  }
}
```
```

[![@amnn](https://avatars.githubusercontent.com/u/332275?s=40&u=fbf218c7e4a657c413a08873087b3f79c535da22&v=4)](/amnn)
[amnn](/amnn)
self-assigned this
[Nov 18, 2025](#event-21017990284)

[![@amnn](https://avatars.githubusercontent.com/u/332275?s=40&u=fbf218c7e4a657c413a08873087b3f79c535da22&v=4)](/amnn)
[amnn](/amnn)
requested a review
from a team
as a [code owner](/MystenLabs/sui/blob/a079505cb816f9d3fb6e1677a4de8e139c89eb6f/.github/CODEOWNERS#L20)
[November 18, 2025 14:40](#event-21017990543)

[![@amnn](https://avatars.githubusercontent.com/u/332275?s=40&u=fbf218c7e4a657c413a08873087b3f79c535da22&v=4)](/amnn)
[amnn](/amnn)
requested review from
[emmazzz](/emmazzz),
[evan-wall-mysten](/evan-wall-mysten),
[henryachen](/henryachen),
[tpham-mysten](/tpham-mysten) and
[wlmyng](/wlmyng)
[November 18, 2025 14:40](#event-21017990785)

[![@amnn](https://avatars.githubusercontent.com/u/332275?s=40&u=fbf218c7e4a657c413a08873087b3f79c535da22&v=4)](/amnn)
[amnn](/amnn)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/19470009163/job/55714387142)
to
sui-typescript-aws-kms-test-env
[November 18, 2025 14:40](#event-21017993195) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=80&v=4)](/apps/vercel)

Copy link

### **[vercel](/apps/vercel) bot** commented [Nov 18, 2025](#issuecomment-3547926575)

|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| The latest updates on your projects. Learn more about [Vercel for GitHub](https://vercel.link/github-learn-more). 2 Skipped Deployments   | Project | Deployment | Preview | Comments | Updated (UTC) | | --- | --- | --- | --- | --- | | [multisig-toolkit](https://vercel.com/mysten-labs/multisig-toolkit) | [Ignored](https://camo.githubusercontent.com/6af980227b4c827b4b58e336e17b2523b7763da7d328256138bdddcbbe31ecbb/68747470733a2f2f76657263656c2e636f6d2f7374617469632f7374617475732f63616e63656c65642e737667) [Ignored](https://vercel.com/mysten-labs/multisig-toolkit/C43TGombjn8WaT1o2eDaVpok85cv) |  |  | Nov 18, 2025 2:40pm | | [sui-kiosk](https://vercel.com/mysten-labs/sui-kiosk) | [Ignored](https://camo.githubusercontent.com/6af980227b4c827b4b58e336e17b2523b7763da7d328256138bdddcbbe31ecbb/68747470733a2f2f76657263656c2e636f6d2f7374617469632f7374617475732f63616e63656c65642e737667) [Ignored](https://vercel.com/mysten-labs/sui-kiosk/DzDMRVVr4gic2GFzv36F6toXPcs5) |  |  | Nov 18, 2025 2:40pm | |

All reactions

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

[![evan-wall-mysten](https://avatars.githubusercontent.com/u/219740240?s=60&v=4)](/evan-wall-mysten)

**[evan-wall-mysten](/evan-wall-mysten)**
reviewed
[Nov 18, 2025](#pullrequestreview-3478549744)

[View reviewed changes](/MystenLabs/sui/pull/24319/files/fcb3b65188376777f416924f07e3745108ac9e98)

[crates/sui-indexer-alt-graphql/src/extensions/query\_limits/payload.rs](/MystenLabs/sui/pull/24319/files/fcb3b65188376777f416924f07e3745108ac9e98#diff-91034fa5b19b41f14236d4a2f40b264258f81dc6ded5155f3a164cb7e40f8bc0)

|  |  |  |
| --- | --- | --- |
|  |  | // they will still be counted as part of the query payload (and so are still |
|  |  | // subject to a limit). |
|  |  | V::Boolean(b) => { |
|  |  | debit!(if \*b { "true".len() } else { "false".len() }); |

Copy link

Collaborator

### @evan-wall-mysten **[evan-wall-mysten](/evan-wall-mysten)** [Nov 18, 2025](#discussion_r2538768822)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved
 
Hide comment

Is there a way to use the JSON serializer framework for some of this?

I hadn't seen how the query limits were enforced before, but I thought it was short circuiting the serializer if the output got to a certain size.

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

All reactions

Copy link

Contributor

Author

### @amnn **[amnn](/amnn)** [Nov 18, 2025](#discussion_r2539073834)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved
 
Hide comment

Note that the input here is not just (originally) JSON, it's also GraphQL queries/requests, so it's not purely a deserialization problem, it's also (in fact it's mostly) a parsing problem, and `async_graphql` does not provide enough hooks into its parser to do what you are suggesting, nor does it provide span information that we could use to detect the size of the source that contributed to a particular node in the AST (it provides line and column positions, but not byte offsets or lengths).

We get to see the data as bytes, and then we get to see it fully parsed, so we do an early check that the input to the parser (the bytes) is not large enough to cause a problem for the parser, and then the rest of the checks are applied to the already parsed input.

The transaction payload checks also require that we know enough about the input to identify e.g. a call to `Query.simulateTransaction`, so we do need to go through parsing, in order to make use of the visitor which works on an input that has done enough analysis that it can identify types, field names, etc, which is another reason that it's difficult to perform this kind of check on the fly.

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

All reactions

[![evan-wall-mysten](https://avatars.githubusercontent.com/u/219740240?s=60&v=4)](/evan-wall-mysten)

**[evan-wall-mysten](/evan-wall-mysten)**
reviewed
[Nov 18, 2025](#pullrequestreview-3478580719)

[View reviewed changes](/MystenLabs/sui/pull/24319/files/fcb3b65188376777f416924f07e3745108ac9e98)

[crates/sui-indexer-alt-graphql/src/extensions/query\_limits/mod.rs](/MystenLabs/sui/pull/24319/files/fcb3b65188376777f416924f07e3745108ac9e98#diff-10325ed14d1a78aa7ef4cb30d20ee2d11d269a4ab9605d814d135774a951633f)

|  |  |  |
| --- | --- | --- |
|  |  |  |
|  |  | /// Test that structured (JSON object) transaction payloads are counted correctly. |
|  |  | #[tokio::test] |
|  |  | async fn test\_tx\_payload\_structured\_inline() { |

Copy link

Collaborator

### @evan-wall-mysten **[evan-wall-mysten](/evan-wall-mysten)** [Nov 18, 2025](#discussion_r2538793308)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved
 
Hide comment

Not related specifically to this PR, but is there a way to see test coverage in our PRs? It is hard to tell if all branches are covered in PRs like this.

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

All reactions

Copy link

Contributor

Author

### @amnn **[amnn](/amnn)** [Nov 18, 2025](#discussion_r2539075742)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved
 
Hide comment

I believe it's technically possible, but not something that we have set-up in our codebase.

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

All reactions

[![evan-wall-mysten](https://avatars.githubusercontent.com/u/219740240?s=60&v=4)](/evan-wall-mysten)

**[evan-wall-mysten](/evan-wall-mysten)**
approved these changes
[Nov 18, 2025](#pullrequestreview-3478590783)

[View reviewed changes](/MystenLabs/sui/pull/24319/files/fcb3b65188376777f416924f07e3745108ac9e98)

Copy link

Collaborator

### @evan-wall-mysten **[evan-wall-mysten](/evan-wall-mysten)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved
 
Hide comment

The change looks correct, just a question about hooking into the Rust JSON library which I'm not very familiar with.

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

üëç
1
 amnn reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Hide details
View details
[![@amnn](https://avatars.githubusercontent.com/u/332275?s=40&u=fbf218c7e4a657c413a08873087b3f79c535da22&v=4)](/amnn)
[amnn](/amnn)
merged commit [`3985500`](/MystenLabs/sui/commit/398550014887f2eafa4534916450487054a1b5ff)
into

main
[Nov 18, 2025](https://github.com/MystenLabs/sui/pull/24319#event-21022145270)

55 of 56 checks passed

### Uh oh!

There was an error while loading. Please reload this page.

[![@amnn](https://avatars.githubusercontent.com/u/332275?s=40&u=fbf218c7e4a657c413a08873087b3f79c535da22&v=4)](/amnn)
[amnn](/amnn)
deleted the

amnn/gql-tx-limits
 
branch
[November 18, 2025 17:23](#event-21022146444)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FMystenLabs%2Fsui%2Fpull%2F24319)

### Reviewers

[![@evan-wall-mysten](https://avatars.githubusercontent.com/u/219740240?s=40&v=4)](/evan-wall-mysten) [evan-wall-mysten](/evan-wall-mysten)

evan-wall-mysten approved these changes

[![@henryachen](https://avatars.githubusercontent.com/u/8963934?s=40&v=4)](/henryachen) [henryachen](/henryachen)






 Awaiting requested review from henryachen






 henryachen is a code owner automatically assigned from MystenLabs/devx-indexers-and-rpcs

[![@emmazzz](https://avatars.githubusercontent.com/u/14351986?s=40&v=4)](/emmazzz) [emmazzz](/emmazzz)






 Awaiting requested review from emmazzz






 emmazzz is a code owner automatically assigned from MystenLabs/devx-indexers-and-rpcs

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng) [wlmyng](/wlmyng)






 Awaiting requested review from wlmyng






 wlmyng is a code owner automatically assigned from MystenLabs/devx-indexers-and-rpcs

[![@tpham-mysten](https://avatars.githubusercontent.com/u/214580142?s=40&v=4)](/tpham-mysten) [tpham-mysten](/tpham-mysten)






 Awaiting requested review from tpham-mysten






 tpham-mysten is a code owner automatically assigned from MystenLabs/devx-indexers-and-rpcs

### Assignees

[![@amnn](https://avatars.githubusercontent.com/u/332275?s=40&v=4)](/amnn) [amnn](/amnn)

### Labels

None yet

### Projects

None yet

### Milestone

No milestone

### Development

Successfully merging this pull request may close these issues.

### Uh oh!

There was an error while loading. Please reload this page.

### 3 participants

[![@amnn](https://avatars.githubusercontent.com/u/332275?s=52&v=4)](/amnn) [![@evan-wall-mysten](https://avatars.githubusercontent.com/u/219740240?s=52&v=4)](/evan-wall-mysten)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

You can‚Äôt perform that action at this time.