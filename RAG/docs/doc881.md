[indexer-alt-framework] watermark tasks by wlmyng ¬∑ Pull Request #23737 ¬∑ MystenLabs/sui ¬∑ GitHub



[Skip to content](#start-of-content)







## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMystenLabs%2Fsui%2Fpull%2F23737)

Appearance settings

Search or jump to...


# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.


Include my email address so I can be contacted

Cancel
 Submit feedback





# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

Cancel
 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMystenLabs%2Fsui%2Fpull%2F23737)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=MystenLabs%2Fsui)

Appearance settings

Resetting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.
 


Dismiss alert

{{ message }}

[MystenLabs](/MystenLabs) 
/
**[sui](/MystenLabs/sui)**
Public

* [Notifications](/login?return_to=%2FMystenLabs%2Fsui) You must be signed in to change notification settings
* [Fork
  11.7k](/login?return_to=%2FMystenLabs%2Fsui)
* [Star
   7.5k](/login?return_to=%2FMystenLabs%2Fsui)

# [indexer-alt-framework] watermark tasks #23737

New issue

 

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

[Sign up for GitHub](/signup?return_to=%2FMystenLabs%2Fsui%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FMystenLabs%2Fsui%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

Merged

[wlmyng](/wlmyng)
merged 6 commits into
[main](/MystenLabs/sui/tree/main "MystenLabs/sui:main")
from
[indexer-framework/watermark-tasks](/MystenLabs/sui/tree/indexer-framework/watermark-tasks "MystenLabs/sui:indexer-framework/watermark-tasks")








Nov 25, 2025

Merged

# [[indexer-alt-framework] watermark tasks](#top) #23737

[wlmyng](/wlmyng)
merged 6 commits into
[main](/MystenLabs/sui/tree/main "MystenLabs/sui:main")
from
[indexer-framework/watermark-tasks](/MystenLabs/sui/tree/indexer-framework/watermark-tasks "MystenLabs/sui:indexer-framework/watermark-tasks")








Nov 25, 2025

### Uh oh!

There was an error while loading. Please reload this page.

## Conversation

This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

[Show hidden characters]({{ revealButtonHref }})








[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=80&v=4)](/wlmyng)

Copy link

Contributor

### @wlmyng **[wlmyng](/wlmyng)** commented [Sep 25, 2025](#issue-3451382841) ‚Ä¢ edited Loading Uh oh! There was an error while loading. Please reload this page.

## Description

Building on [#24192](https://github.com/MystenLabs/sui/pull/24192), we now have new fields `--task` and `--reader-interval-ms`, which when set creates an indexer whose pipelines commit checkpoint data as long as it is not less than each of its main pipeline's `pruner_hi`.

Startup behavior remains the same as defined in the previous PR: all pipelines, tasked or not, will resume committing from next after its committer watermark, or expect 0, unless overridden by `--first-checkpoint`.

The indexer determines ingestion as the smallest next checkpoint across pipelines (as calculated above.)

To backfill, operators either:

* run a new indexer with `-task` and `-first-checkpoint` (preferred), or
* wipe watermark entries for main pipelines (without task) and restart main indexer with `-first-checkpoint.`

Multiple tasked indexers can run in parallel with different ranges to accelerate backfill.

## Test plan

New tests in `lib.rs` and `collector.rs`

Additional tests in `collector`

---

## Release notes

Check each box that your changes affect. If none of the boxes relate to your changes, release notes aren't required.

For each box you select, include information after the relevant heading that describes the impact of your changes that a user might notice and any actions they must take to implement updates.

* Protocol:
* Nodes (Validators and Full nodes):
* gRPC:
* JSON-RPC:  
  This PR, in tandem with¬†[[indexer-alt-framework] remove `skip_watermark` and standardize `first_checkpoint` behavior¬†#24192](https://github.com/MystenLabs/sui/pull/24192), unifies how indexers determine their ingestion starting point and introduce watermark-gated backfill tasks.

1. `--skip-watermark`¬†is removed, and the previous ability to bypass watermark safety checks for concurrent pipelines is no longer supported.
2. `--first-checkpoint`¬†no longer forces the indexer to start ingesting from the configured checkpoint. The indexer now always determines its starting ingestion point as the minimum next checkpoint across all pipelines to resume processing from. From this release, `--first-checkpoint` now only applies to pipelines that do not yet have a committer watermark. These pipelines will resume processing from the configured value. Pipelines with existing watermarks will always resume processing from their own next checkpoint.
3. A new mechanism, watermark tasks, allows operators to run the same pipelines on multiple indexer instances for historical backfilling. Two new flags,¬†`--task`¬†and¬†`--reader-interval-ms`, enable this mechanism. These flags create a tasked indexer whose pipelines commit checkpoint data as long as the checkpoint is not below the¬†`reader_lo`¬†watermark of their corresponding main pipelines. The indexer controls how frequently these tasked pipelines poll the main pipelines' watermarks per¬†`--reader-interval-ms`.

Migration guidance:

1. If you use¬†`--first-checkpoint`¬†only for¬†*initial*¬†ingestion of a fresh pipeline, no further action is needed.
2. If you previously used¬†`--first-checkpoint`¬†and optionally¬†`--skip-watermark`¬†to backfill existing tables, you can achieve the same workflow by starting a new indexer instance with a configured¬†`--task`,¬†`--reader-interval-ms`, and¬†`--first-checkpoint`.
3. Like¬†`--skip-watermark`,¬†`--task`¬†cannot be used to run sequential pipelines.

* GraphQL:  
  See above
* CLI:
* Rust SDK:

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

All reactions

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/17993288542/job/51187708385)
to
sui-typescript-aws-kms-test-env
[September 25, 2025 00:31](#event-19906040934) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=80&v=4)](/apps/vercel)

Copy link

### **[vercel](/apps/vercel) bot** commented [Sep 25, 2025](#issuecomment-3331169704) ‚Ä¢ edited Loading Uh oh! There was an error while loading. Please reload this page.

|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| The latest updates on your projects. Learn more about [Vercel for GitHub](https://vercel.link/github-learn-more).   | Project | Deployment | Preview | Comments | Updated (UTC) | | --- | --- | --- | --- | --- | | [sui-docs](https://vercel.com/sui-foundation/sui-docs) | [Ready](https://camo.githubusercontent.com/2d058aa4937109084c3b00dc259081ef9f01257a8504a292a286041635575d96/68747470733a2f2f76657263656c2e636f6d2f7374617469632f7374617475732f72656164792e737667) [Ready](https://vercel.com/sui-foundation/sui-docs/DxXzmkY9kq9uKv4oKvKbsmPnunpm) | [Preview](https://sui-docs-git-indexer-framework-watermark-tasks-sui-foundation.vercel.app) | [Comment](https://vercel.live/open-feedback/sui-docs-git-indexer-framework-watermark-tasks-sui-foundation.vercel.app?via=pr-comment-feedback-link) | Nov 25, 2025 2:34am |  2 Skipped Deployments   | Project | Deployment | Preview | Comments | Updated (UTC) | | --- | --- | --- | --- | --- | | [multisig-toolkit](https://vercel.com/mysten-labs/multisig-toolkit) | [Ignored](https://camo.githubusercontent.com/6af980227b4c827b4b58e336e17b2523b7763da7d328256138bdddcbbe31ecbb/68747470733a2f2f76657263656c2e636f6d2f7374617469632f7374617475732f63616e63656c65642e737667) [Ignored](https://vercel.com/mysten-labs/multisig-toolkit/244J3aEbtaK78ZCwpJpcFnSpLiDw) | [Preview](https://multisig-toolkit-git-indexer-framework-water-f4bc0c-mysten-labs.vercel.app) |  | Nov 25, 2025 2:34am | | [sui-kiosk](https://vercel.com/mysten-labs/sui-kiosk) | [Ignored](https://camo.githubusercontent.com/6af980227b4c827b4b58e336e17b2523b7763da7d328256138bdddcbbe31ecbb/68747470733a2f2f76657263656c2e636f6d2f7374617469632f7374617475732f63616e63656c65642e737667) [Ignored](https://vercel.com/mysten-labs/sui-kiosk/6nGennCNLrqPSQ4f32zp8QQcb3Z3) | [Preview](https://sui-kiosk-git-indexer-framework-watermark-tasks-mysten-labs.vercel.app) |  | Nov 25, 2025 2:34am | |

All reactions

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-loq2vnx6d-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-loq2vnx6d-sui-foundation.vercel.app)
[September 25, 2025 00:33](#event-19906074465)
[View deployment](https://sui-docs-loq2vnx6d-sui-foundation.vercel.app)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
changed the title
~~Indexer framework/watermark tasks~~
[indexer-alt-framework] watermark tasks
[Sep 29, 2025](#event-19994958401)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[force-pushed](/MystenLabs/sui/compare/418824e40f251dfcbd072547ca3aa13ad0bc2a33..676d03128d094b6a4b2f1425c4c65bbbb5c3b67d)
the

indexer-framework/watermark-tasks
branch
from
[`418824e`](/MystenLabs/sui/commit/418824e40f251dfcbd072547ca3aa13ad0bc2a33) to
[`676d031`](/MystenLabs/sui/commit/676d03128d094b6a4b2f1425c4c65bbbb5c3b67d)  [Compare](/MystenLabs/sui/compare/418824e40f251dfcbd072547ca3aa13ad0bc2a33..676d03128d094b6a4b2f1425c4c65bbbb5c3b67d)
[September 29, 2025 22:41](#event-19994993499)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/18112794584/job/51542476244)
to
sui-typescript-aws-kms-test-env
[September 29, 2025 22:41](#event-19994995834) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-ai8juf9sg-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-ai8juf9sg-sui-foundation.vercel.app)
[September 29, 2025 22:43](#event-19995025801)
[View deployment](https://sui-docs-ai8juf9sg-sui-foundation.vercel.app)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/18148382690/job/51654375594)
to
sui-typescript-aws-kms-test-env
[October 1, 2025 01:31](#event-20022989213) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-k7zo07ma3-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-k7zo07ma3-sui-foundation.vercel.app)
[October 1, 2025 01:33](#event-20023017730)
[View deployment](https://sui-docs-k7zo07ma3-sui-foundation.vercel.app)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[force-pushed](/MystenLabs/sui/compare/cb1618c77d55bc09fa06cfe546294b0d4ad45925..1a47961f6b5305553cbb73df321175ae914cdda9)
the

indexer-framework/watermark-tasks
branch
from
[`cb1618c`](/MystenLabs/sui/commit/cb1618c77d55bc09fa06cfe546294b0d4ad45925) to
[`1a47961`](/MystenLabs/sui/commit/1a47961f6b5305553cbb73df321175ae914cdda9)  [Compare](/MystenLabs/sui/compare/cb1618c77d55bc09fa06cfe546294b0d4ad45925..1a47961f6b5305553cbb73df321175ae914cdda9)
[October 1, 2025 01:45](#event-20023158513)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/18148611130/job/51655010666)
to
sui-typescript-aws-kms-test-env
[October 1, 2025 01:45](#event-20023159078) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-bg7pfvdcn-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-bg7pfvdcn-sui-foundation.vercel.app)
[October 1, 2025 01:47](#event-20023181053)
[View deployment](https://sui-docs-bg7pfvdcn-sui-foundation.vercel.app)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[force-pushed](/MystenLabs/sui/compare/1a47961f6b5305553cbb73df321175ae914cdda9..32b11065dfb985d7acac0300b0d29a5e27a80184)
the

indexer-framework/watermark-tasks
branch
from
[`1a47961`](/MystenLabs/sui/commit/1a47961f6b5305553cbb73df321175ae914cdda9) to
[`32b1106`](/MystenLabs/sui/commit/32b11065dfb985d7acac0300b0d29a5e27a80184)  [Compare](/MystenLabs/sui/compare/1a47961f6b5305553cbb73df321175ae914cdda9..32b11065dfb985d7acac0300b0d29a5e27a80184)
[October 1, 2025 02:33](#event-20023676668)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/18149439931/job/51657232846)
to
sui-typescript-aws-kms-test-env
[October 1, 2025 02:33](#event-20023677327) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-qx5omn0zw-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-qx5omn0zw-sui-foundation.vercel.app)
[October 1, 2025 02:35](#event-20023695642)
[View deployment](https://sui-docs-qx5omn0zw-sui-foundation.vercel.app)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[force-pushed](/MystenLabs/sui/compare/32b11065dfb985d7acac0300b0d29a5e27a80184..23e27ee86e34cbb015b950cd139f74c1d7e44503)
the

indexer-framework/watermark-tasks
branch
from
[`32b1106`](/MystenLabs/sui/commit/32b11065dfb985d7acac0300b0d29a5e27a80184) to
[`23e27ee`](/MystenLabs/sui/commit/23e27ee86e34cbb015b950cd139f74c1d7e44503)  [Compare](/MystenLabs/sui/compare/32b11065dfb985d7acac0300b0d29a5e27a80184..23e27ee86e34cbb015b950cd139f74c1d7e44503)
[October 2, 2025 01:08](#event-20047512721)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/18180235652/job/51754556327)
to
sui-typescript-aws-kms-test-env
[October 2, 2025 01:08](#event-20047513289) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-9gk3myp01-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-9gk3myp01-sui-foundation.vercel.app)
[October 2, 2025 01:10](#event-20047536811)
[View deployment](https://sui-docs-9gk3myp01-sui-foundation.vercel.app)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[force-pushed](/MystenLabs/sui/compare/23e27ee86e34cbb015b950cd139f74c1d7e44503..b3477954a78c75cc80afa1e02101ad65b9e063a2)
the

indexer-framework/watermark-tasks
branch
from
[`23e27ee`](/MystenLabs/sui/commit/23e27ee86e34cbb015b950cd139f74c1d7e44503) to
[`b347795`](/MystenLabs/sui/commit/b3477954a78c75cc80afa1e02101ad65b9e063a2)  [Compare](/MystenLabs/sui/compare/23e27ee86e34cbb015b950cd139f74c1d7e44503..b3477954a78c75cc80afa1e02101ad65b9e063a2)
[October 2, 2025 01:10](#event-20047537774)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/18180277961/job/51754668511)
to
sui-typescript-aws-kms-test-env
[October 2, 2025 01:10](#event-20047538390) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-odr5o3rfo-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-odr5o3rfo-sui-foundation.vercel.app)
[October 2, 2025 01:13](#event-20047559461)
[View deployment](https://sui-docs-odr5o3rfo-sui-foundation.vercel.app)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/18180753390/job/51755929324)
to
sui-typescript-aws-kms-test-env
[October 2, 2025 01:39](#event-20047775583) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[force-pushed](/MystenLabs/sui/compare/f9fef4ef1c96da6553d6635c45f38a898313fb40..5f55c035069de8b7dfc08f4f8cc10dec20380a86)
the

indexer-framework/watermark-tasks
branch
from
[`f9fef4e`](/MystenLabs/sui/commit/f9fef4ef1c96da6553d6635c45f38a898313fb40) to
[`5f55c03`](/MystenLabs/sui/commit/5f55c035069de8b7dfc08f4f8cc10dec20380a86)  [Compare](/MystenLabs/sui/compare/f9fef4ef1c96da6553d6635c45f38a898313fb40..5f55c035069de8b7dfc08f4f8cc10dec20380a86)
[October 2, 2025 01:40](#event-20047785975)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/18180776737/job/51755992833)
to
sui-typescript-aws-kms-test-env
[October 2, 2025 01:40](#event-20047786534) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-a907ynnnq-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-a907ynnnq-sui-foundation.vercel.app)
[October 2, 2025 01:43](#event-20047803735)
[View deployment](https://sui-docs-a907ynnnq-sui-foundation.vercel.app)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/18213763576/job/51858994154)
to
sui-typescript-aws-kms-test-env
[October 3, 2025 05:26](#event-20074196147) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-pafuooluk-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-pafuooluk-sui-foundation.vercel.app)
[October 3, 2025 05:27](#event-20074213511)
[View deployment](https://sui-docs-pafuooluk-sui-foundation.vercel.app)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/18213945282/job/51859475202)
to
sui-typescript-aws-kms-test-env
[October 3, 2025 05:37](#event-20074317916) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-57kvfgkid-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-57kvfgkid-sui-foundation.vercel.app)
[October 3, 2025 05:40](#event-20074341154)
[View deployment](https://sui-docs-57kvfgkid-sui-foundation.vercel.app)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[force-pushed](/MystenLabs/sui/compare/e5134940238f4092eb0483aa65d3211ce87b315a..df0f13339b8c98892810046f190e81efc16b28de)
the

indexer-framework/watermark-tasks
branch
from
[`e513494`](/MystenLabs/sui/commit/e5134940238f4092eb0483aa65d3211ce87b315a) to
[`df0f133`](/MystenLabs/sui/commit/df0f13339b8c98892810046f190e81efc16b28de)  [Compare](/MystenLabs/sui/compare/e5134940238f4092eb0483aa65d3211ce87b315a..df0f13339b8c98892810046f190e81efc16b28de)
[October 7, 2025 19:55](#event-20148703087)

107 hidden items

Load more‚Ä¶

[![amnn](https://avatars.githubusercontent.com/u/332275?s=60&v=4)](/amnn)

**[amnn](/amnn)**
approved these changes
[Nov 21, 2025](#pullrequestreview-3493824132)

[View reviewed changes](/MystenLabs/sui/pull/23737/files)

Copy link

Contributor

### @amnn **[amnn](/amnn)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved
 
Hide comment

Okay, I think we're there, modulo some final comments! Thanks [@wlmyng](https://github.com/wlmyng). PTAL at

* Simplifying the `SetOnce` usage (and cleaning up the abstraction boundaries).
* Reducing the timeouts on tests -- unit tests should not need to wait for multiple seconds at a time, and definitely should not need 100 second timeouts.

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

All reactions

[crates/sui-indexer-alt-framework/src/pipeline/concurrent/collector.rs](/MystenLabs/sui/pull/23737/files#diff-5e2b9bf852f10dcecddd975994b4687c2d356745dfb7b427345352b7ee567b9a)

|  |  |  |
| --- | --- | --- |
|  |  | Some(mut indexed) = rx.recv(), if pending\_rows < H::MAX\_PENDING\_ROWS => { |
|  |  | // Clear the values of outdated checkpoints, so that we don't commit data to the |
|  |  | // store, but can still advance watermarks. |
|  |  | if indexed.checkpoint() < atomic\_reader\_lo.load(Ordering::Relaxed) { |

Copy link

Contributor

### @amnn **[amnn](/amnn)** [Nov 21, 2025](#discussion_r2550557902)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved
 
Hide comment

Why can you not just do this, and avoid the all that code at the top?

Suggested change

|  |  |
| --- | --- |
|  | if indexed.checkpoint() < atomic\_reader\_lo.load(Ordering::Relaxed) { |
|  | if indexed.checkpoint() < main\_reader\_lo.wait().await.load(Ordering::Relaxed) { |

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

All reactions

Copy link

Contributor

Author

### @wlmyng **[wlmyng](/wlmyng)** [Nov 21, 2025](#discussion_r2551224568)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved
 
Hide comment

Discussed on slack, but the pieces of a pipeline shut down conditioned on the processor channel, so the main reader lo task would have to either be aware of that too, or subscribe to the pruner\_cancel.

The inline check could stall forever, preventing the collector from getting to the check in the other branch for

```move
                    if pending_rows > 0 {
                        poll.reset_immediately();
                    } else if rx.is_closed() && rx.is_empty() {
                        info!(
                            pipeline = H::NAME,
                            "Processor closed channel, pending rows empty, stopping collector",
                        );
                        break;
                    }
                }
```

I'll leave a todo on the init in the collector above for us to revisit

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

All reactions







[crates/sui-indexer-alt-framework/src/pipeline/concurrent/main\_reader\_lo.rs](/MystenLabs/sui/pull/23737/files#diff-ef5c5e63a3156cab552a1bbc507cb9de91e32365b0df68410d575a3bab20653e)

Outdated
 


Show resolved


Hide resolved

### Uh oh!

There was an error while loading. Please reload this page.







[crates/sui-indexer-alt-framework/src/pipeline/concurrent/mod.rs](/MystenLabs/sui/pull/23737/files#diff-2b93a9e933b1c6a58c20dfa88457ee2066b585a0692392d49e5b7509e98bfbd4)

Outdated
 


Show resolved


Hide resolved

### Uh oh!

There was an error while loading. Please reload this page.







[crates/sui-indexer-alt-framework/src/lib.rs](/MystenLabs/sui/pull/23737/files#diff-d828bd85be0cbba9f1dd6c9e20da42af42915b7f6a0beffa688da153b34d6a6d)

Outdated
 


Show resolved


Hide resolved

### Uh oh!

There was an error while loading. Please reload this page.







[crates/sui-indexer-alt-framework/src/lib.rs](/MystenLabs/sui/pull/23737/files#diff-d828bd85be0cbba9f1dd6c9e20da42af42915b7f6a0beffa688da153b34d6a6d)

Outdated
 


Show resolved


Hide resolved

### Uh oh!

There was an error while loading. Please reload this page.







[crates/sui-indexer-alt-framework/src/lib.rs](/MystenLabs/sui/pull/23737/files#diff-d828bd85be0cbba9f1dd6c9e20da42af42915b7f6a0beffa688da153b34d6a6d)

Outdated
 


Show resolved


Hide resolved

### Uh oh!

There was an error while loading. Please reload this page.







[crates/sui-indexer-alt-framework/src/lib.rs](/MystenLabs/sui/pull/23737/files#diff-d828bd85be0cbba9f1dd6c9e20da42af42915b7f6a0beffa688da153b34d6a6d)

Outdated

|  |  |  |
| --- | --- | --- |
|  |  | .wait\_for\_watermark( |
|  |  | &pipeline\_task::<MockStore>(ControllableHandler::NAME, Some("task")).unwrap(), |
|  |  | 100, |
|  |  | std::time::Duration::from\_millis(100\_000), |

Copy link

Contributor

### @amnn **[amnn](/amnn)** [Nov 21, 2025](#discussion_r2550589811)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved
 
Hide comment

Would this work?

Suggested change

|  |  |
| --- | --- |
|  | std::time::Duration::from\_millis(100\_000), |
|  | std::time::Duration::from\_secs(100), |

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

All reactions

Copy link

Contributor

### @amnn **[amnn](/amnn)** [Nov 21, 2025](#discussion_r2550593250)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved
 
Hide comment

But also ...100 seconds, why?!

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

All reactions

Copy link

Contributor

Author

### @wlmyng **[wlmyng](/wlmyng)** [Nov 22, 2025](#discussion_r2551343958)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved
 
Hide comment

using `start_paused=true`, i can have something like

```move
        tokio::time::advance(std::time::Duration::from_secs(500)).await;
        store
            .wait_for_watermark(
                &pipeline_task::<MockStore>(ControllableHandler::NAME, Some("task")).unwrap(),
                100,
                std::time::Duration::from_secs(1),
```

whole test completes under 3 seconds now

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

All reactions

Copy link

Contributor

### @amnn **[amnn](/amnn)** [Nov 22, 2025](#discussion_r2553105135)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved
 
Hide comment

Ah I see -- I can stop sweating now. It would still be nice to use times that are at least in the same order of magnitude as the times the services are expected to experience in production to avoid confusion in the future though.

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

All reactions

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/19586985391/job/56097865717)
to
sui-typescript-aws-kms-test-env
[November 22, 2025 00:11](#event-21107724413) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-kry6dhojo-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-kry6dhojo-sui-foundation.vercel.app)
[November 22, 2025 00:13](#event-21107753377)
[View deployment](https://sui-docs-kry6dhojo-sui-foundation.vercel.app)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/19588353218/job/56101800293)
to
sui-typescript-aws-kms-test-env
[November 22, 2025 01:46](#event-21108702651) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-9q71a4i1o-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-9q71a4i1o-sui-foundation.vercel.app)
[November 22, 2025 01:48](#event-21108725908)
[View deployment](https://sui-docs-9q71a4i1o-sui-foundation.vercel.app)

Base automatically changed from
indexer-framework-align-first-checkpoint-usage
 to
main
[November 24, 2025 23:53](#event-21151494399)

[wlmyng](/wlmyng)
added 4 commits
[November 24, 2025 15:54](#commits-pushed-b9ef057)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)

`New indexer arg '--task' to enable pipelines to run with watermark en‚Ä¶`

 ‚Ä¶

`b9ef057`

```move
‚Ä¶tries keyed separately from main pipelines.

Take out skip_watermark on the top level.
Separate task that periodically checks value of reader_lo from main pipeline.

Make delimiter part of the Store trait. The choice of delimiter is only relevant to the implementor of Store. At the indexer level, an operator can just choose to pass in an optional task string. The exact watermark_key to be created is thus up to the Store implementor, and otherwise invisible to the indexer operator. Should also make it easier to validate pipeline names going forward. Address nits and other smaller comments

move main_reader_lo filtering logic out of processor and into collector, since its restricted to concurrent pipelines

Split out the main_reader_lo task into its own module. Change the logic slightly, so that the concurrent collector waits for the task to populate the value before it starts building batches. When adding a checkpoint to a batch, the collector should check that the checkpoint is not less than the reader watermark.

rename pipeline to pipeline_task for committer_watermark and set_committer_watermark methods

simplify startup logic for tasked indexers. set concurrent pipelines next_checkpoint as normal, and allow main_reader_lo task and framework logic to manage skipping checkpoints. The number of skipped checkpoints will be logged to metrics.

Accompanying test case.

Integrate watch channel from main_reader_lo task to the collector.
Tests for collector + watch channel piece.

clear values, but keep the checkpoint, so we can still advance watermarks

consolidate name to pipeline_task. Store allows implementors to choose the delimiter character, but restrict the format to {pipeline}{delimiter}{task}. address some nits

rename collector_skipped_checkpoints to total_collector_skipped_checkpoints
```

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)

`The collector waits for the SetOnce<AtomicU64> to be initialized befo‚Ä¶`

 ‚Ä¶

`89d6386`

```move
‚Ä¶re it continues work. During this init phase, the collector will close if the processor has also shutdown. Otherwise, the collector will largely operate as normal, referring to the main reader lo to filter out whole checkpoints before passing them down to the committer.
```

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)

`consolidate is_valid_pipeline and pipeline_task. can't construct the ‚Ä¶`

 ‚Ä¶

`a97d56b`

```move
‚Ä¶latter if pipeline is invalid anyways
```

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)

`TaskArgs`

`a9703a1`

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[force-pushed](/MystenLabs/sui/compare/09d6367e4b659497c48bff8eff90344a281a4498..895b619060097df9cd4f64a52b14a7efca7cb4ba)
the

indexer-framework/watermark-tasks
branch
from
[`09d6367`](/MystenLabs/sui/commit/09d6367e4b659497c48bff8eff90344a281a4498) to
[`895b619`](/MystenLabs/sui/commit/895b619060097df9cd4f64a52b14a7efca7cb4ba)  [Compare](/MystenLabs/sui/compare/09d6367e4b659497c48bff8eff90344a281a4498..895b619060097df9cd4f64a52b14a7efca7cb4ba)
[November 24, 2025 23:54](#event-21151509200)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/19653258867/job/56284530006)
to
sui-typescript-aws-kms-test-env
[November 24, 2025 23:54](#event-21151509642) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-56e5vmpfh-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-56e5vmpfh-sui-foundation.vercel.app)
[November 24, 2025 23:57](#event-21151535971)
[View deployment](https://sui-docs-56e5vmpfh-sui-foundation.vercel.app)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/19654353827/job/56287846973)
to
sui-typescript-aws-kms-test-env
[November 25, 2025 00:49](#event-21152191748) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-fgogtet92-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-fgogtet92-sui-foundation.vercel.app)
[November 25, 2025 00:51](#event-21152218555)
[View deployment](https://sui-docs-fgogtet92-sui-foundation.vercel.app)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/19655201475/job/56290279070)
to
sui-typescript-aws-kms-test-env
[November 25, 2025 01:34](#event-21152816464) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-gjic0v3bu-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-gjic0v3bu-sui-foundation.vercel.app)
[November 25, 2025 01:36](#event-21152836371)
[View deployment](https://sui-docs-gjic0v3bu-sui-foundation.vercel.app)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)

`Test where we withhold checkpoints from further processing so we can ‚Ä¶`

 ‚Ä¶

`ff3f95a`

```move
‚Ä¶actually test skipping checkpoints that trail reader_lo.

maybe paused time is too complicated for this one. set collect_interval_ms and watermark_interval_ms to 10 ms from 500 ms, so 100 checkpoints would take about 1 second if each checkpoint waits for an interval tick
```

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[force-pushed](/MystenLabs/sui/compare/5e08bc52b5ee86edbde8d5008b7e46cfe4c4656f..ff3f95aaf041bf2b965e1c010bee240a00331d60)
the

indexer-framework/watermark-tasks
branch
from
[`5e08bc5`](/MystenLabs/sui/commit/5e08bc52b5ee86edbde8d5008b7e46cfe4c4656f) to
[`ff3f95a`](/MystenLabs/sui/commit/ff3f95aaf041bf2b965e1c010bee240a00331d60)  [Compare](/MystenLabs/sui/compare/5e08bc52b5ee86edbde8d5008b7e46cfe4c4656f..ff3f95aaf041bf2b965e1c010bee240a00331d60)
[November 25, 2025 02:07](#event-21153271314)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/19655797951/job/56291954301)
to
sui-typescript-aws-kms-test-env
[November 25, 2025 02:07](#event-21153271979) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-5zut2kcb0-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-5zut2kcb0-sui-foundation.vercel.app)
[November 25, 2025 02:09](#event-21153296807)
[View deployment](https://sui-docs-5zut2kcb0-sui-foundation.vercel.app)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)

`please`

`ba7a15a`

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/19656230769/job/56293218262)
to
sui-typescript-aws-kms-test-env
[November 25, 2025 02:32](#event-21153583003) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-i5320zyn4-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-i5320zyn4-sui-foundation.vercel.app)
[November 25, 2025 02:34](#event-21153602189)
[View deployment](https://sui-docs-i5320zyn4-sui-foundation.vercel.app)

Hide details
View details
[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
merged commit [`75e461e`](/MystenLabs/sui/commit/75e461e43ac0c36d71ceea1d5c1b7c0af369e624)
into

main
[Nov 25, 2025](https://github.com/MystenLabs/sui/pull/23737#event-21154431424)

72 of 73 checks passed

### Uh oh!

There was an error while loading. Please reload this page.

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
deleted the

indexer-framework/watermark-tasks
 
branch
[November 25, 2025 03:50](#event-21154431762)

[![@nickvikeras](https://avatars.githubusercontent.com/u/1908006?s=40&u=41cf6749908e1df405acc740b071534182c977b3&v=4)](/nickvikeras)
[nickvikeras](/nickvikeras)
mentioned this pull request
[Nov 26, 2025](#ref-pullrequest-3668651883)

[Removing dead arg
#24447](/MystenLabs/sui/pull/24447)

Merged

[nickvikeras](/nickvikeras)
added a commit
that referenced
this pull request
[Nov 26, 2025](#ref-commit-4edc6e7)

[![@nickvikeras](https://avatars.githubusercontent.com/u/1908006?s=40&u=41cf6749908e1df405acc740b071534182c977b3&v=4)](/nickvikeras)

`Removing dead arg (#24447)`

‚Ä¶

`4edc6e7`

```move
## Description

<#23737> deprecated this arg in
favor of the proper task args built into the framework. Just removing
the now unused arg now.
```

[![@raress96](https://avatars.githubusercontent.com/u/6453351?s=80&u=92d02327fc2f1b0352d97381ae43b6f53fc86ab2&v=4)](/raress96)

Copy link

### **[raress96](/raress96)** commented [Dec 11, 2025](#issuecomment-3640840647) ‚Ä¢ edited Loading Uh oh! There was an error while loading. Please reload this page.

|  |
| --- |
| Hello [@wlmyng](https://github.com/wlmyng) I am having an issue running an indexer with this latest version:  ```move thread 'main' (95358) panicked at /home/rares/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clap_builder-4.5.43/src/builder/debug_asserts.rs:149:13: Command sui-nft-indexer: Argument or group 'reader-interval-ms' specified in 'requires*' for 'task' does not exist ```  Shouldn't the fields here in `TaskArgs` be public?  [75e461e#diff-d828bd85be0cbba9f1dd6c9e20da42af42915b7f6a0beffa688da153b34d6a6dR85](https://github.com/MystenLabs/sui/commit/75e461e43ac0c36d71ceea1d5c1b7c0af369e624#diff-d828bd85be0cbba9f1dd6c9e20da42af42915b7f6a0beffa688da153b34d6a6dR85)  And on this note, what would be a good value for the `reader-interval-ms` option? |

All reactions

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

[![@amnn](https://avatars.githubusercontent.com/u/332275?s=80&u=fbf218c7e4a657c413a08873087b3f79c535da22&v=4)](/amnn)

Copy link

Contributor

### **[amnn](/amnn)** commented [Dec 11, 2025](#issuecomment-3641601292)

|  |
| --- |
| Hi [@raress96](https://github.com/raress96), thanks for the report. This issue is fixed in `main` by [#24501](https://github.com/MystenLabs/sui/pull/24501)  We would recommend using a similar number here as in the polling interval of watermark tasks for RPCs (between 500ms and 1s). The main thing is that this should be much smaller than the delay that the pruner applies before acting on a new reader low watermark (we usually use a value of about 5 minutes for that). |

üëç
1
 raress96 reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FMystenLabs%2Fsui%2Fpull%2F23737)

### Reviewers

[![@amnn](https://avatars.githubusercontent.com/u/332275?s=40&v=4)](/amnn) [amnn](/amnn)

amnn approved these changes

[![@henryachen](https://avatars.githubusercontent.com/u/8963934?s=40&v=4)](/henryachen) [henryachen](/henryachen)






 Awaiting requested review from henryachen






 henryachen is a code owner automatically assigned from MystenLabs/devx-indexers-and-rpcs

[![@tpham-mysten](https://avatars.githubusercontent.com/u/214580142?s=40&v=4)](/tpham-mysten) [tpham-mysten](/tpham-mysten)






 Awaiting requested review from tpham-mysten






 tpham-mysten is a code owner automatically assigned from MystenLabs/devx-indexers-and-rpcs

[![@evan-wall-mysten](https://avatars.githubusercontent.com/u/219740240?s=40&v=4)](/evan-wall-mysten) [evan-wall-mysten](/evan-wall-mysten)






 Awaiting requested review from evan-wall-mysten






 evan-wall-mysten is a code owner automatically assigned from MystenLabs/devx-indexers-and-rpcs

[![@nickvikeras](https://avatars.githubusercontent.com/u/1908006?s=40&v=4)](/nickvikeras) [nickvikeras](/nickvikeras)






 Awaiting requested review from nickvikeras

[![@ronny-mysten](https://avatars.githubusercontent.com/u/118224482?s=40&v=4)](/ronny-mysten) [ronny-mysten](/ronny-mysten)






 Awaiting requested review from ronny-mysten

[![@jessiemongeon1](https://avatars.githubusercontent.com/u/133128541?s=40&v=4)](/jessiemongeon1) [jessiemongeon1](/jessiemongeon1)






 Awaiting requested review from jessiemongeon1

[![@emmazzz](https://avatars.githubusercontent.com/u/14351986?s=40&v=4)](/emmazzz) [emmazzz](/emmazzz)






 Awaiting requested review from emmazzz

### Assignees

No one assigned

### Labels

None yet

### Projects

None yet

### Milestone

No milestone

### Development

Successfully merging this pull request may close these issues.

### Uh oh!

There was an error while loading. Please reload this page.

### 5 participants

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=52&v=4)](/wlmyng) [![@amnn](https://avatars.githubusercontent.com/u/332275?s=52&v=4)](/amnn) [![@raress96](https://avatars.githubusercontent.com/u/6453351?s=52&v=4)](/raress96) [![@emmazzz](https://avatars.githubusercontent.com/u/14351986?s=52&v=4)](/emmazzz)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

You can‚Äôt perform that action at this time.