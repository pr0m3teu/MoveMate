[indexer-alt-framework] remove `skip\_watermark` and standardize `first\_checkpoint` behavior by wlmyng ¬∑ Pull Request #24192 ¬∑ MystenLabs/sui ¬∑ GitHub



[Skip to content](#start-of-content)







## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMystenLabs%2Fsui%2Fpull%2F24192)

Appearance settings

Search or jump to...


# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.


Include my email address so I can be contacted

Cancel
 Submit feedback





# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

Cancel
 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMystenLabs%2Fsui%2Fpull%2F24192)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=MystenLabs%2Fsui)

Appearance settings

Resetting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.
 


Dismiss alert

{{ message }}

[MystenLabs](/MystenLabs) 
/
**[sui](/MystenLabs/sui)**
Public

* [Notifications](/login?return_to=%2FMystenLabs%2Fsui) You must be signed in to change notification settings
* [Fork
  11.7k](/login?return_to=%2FMystenLabs%2Fsui)
* [Star
   7.5k](/login?return_to=%2FMystenLabs%2Fsui)

# [indexer-alt-framework] remove `skip_watermark` and standardize `first_checkpoint` behavior #24192

New issue

 

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

[Sign up for GitHub](/signup?return_to=%2FMystenLabs%2Fsui%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FMystenLabs%2Fsui%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

Merged

[wlmyng](/wlmyng)
merged 1 commit into
[main](/MystenLabs/sui/tree/main "MystenLabs/sui:main")
from
[indexer-framework-align-first-checkpoint-usage](/MystenLabs/sui/tree/indexer-framework-align-first-checkpoint-usage "MystenLabs/sui:indexer-framework-align-first-checkpoint-usage")








Nov 24, 2025

Merged

# [[indexer-alt-framework] remove `skip_watermark` and standardize `first_checkpoint` behavior](#top) #24192

[wlmyng](/wlmyng)
merged 1 commit into
[main](/MystenLabs/sui/tree/main "MystenLabs/sui:main")
from
[indexer-framework-align-first-checkpoint-usage](/MystenLabs/sui/tree/indexer-framework-align-first-checkpoint-usage "MystenLabs/sui:indexer-framework-align-first-checkpoint-usage")








Nov 24, 2025

### Uh oh!

There was an error while loading. Please reload this page.

## Conversation

This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

[Show hidden characters]({{ revealButtonHref }})








[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=80&v=4)](/wlmyng)

Copy link

Contributor

### @wlmyng **[wlmyng](/wlmyng)** commented [Nov 6, 2025](#issue-3593284362) ‚Ä¢ edited Loading Uh oh! There was an error while loading. Please reload this page.

## Description

This PR standardizes behavior around `--first-checkpoint` and its effects on  
A. The checkpoint to start ingesting from  
B. The checkpoint for a pipeline to resume processing from

* When an indexer starts, it will always start ingesting from the next checkpoint after the smallest committed checkpoint across all pipelines added to it.
* Pipelines without a watermark are by default to be backfilled from genesis.
* Providing `--first-checkpoint` overrides this behavior, and tells the indexer that these pipelines are to process checkpoints from `--first-checkpoint` instead.

## Test plan

New tests

---

## Release notes

Check each box that your changes affect. If none of the boxes relate to your changes, release notes aren't required.

For each box you select, include information after the relevant heading that describes the impact of your changes that a user might notice and any actions they must take to implement updates.

* Protocol:
* Nodes (Validators and Full nodes):
* gRPC:
* JSON-RPC:
* GraphQL:
* CLI:
* Rust SDK:

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

All reactions

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=80&v=4)](/apps/vercel)

Copy link

### **[vercel](/apps/vercel) bot** commented [Nov 6, 2025](#issuecomment-3494157333) ‚Ä¢ edited Loading Uh oh! There was an error while loading. Please reload this page.

|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| The latest updates on your projects. Learn more about [Vercel for GitHub](https://vercel.link/github-learn-more).   | Project | Deployment | Preview | Comments | Updated (UTC) | | --- | --- | --- | --- | --- | | [sui-docs](https://vercel.com/sui-foundation/sui-docs) | [Ready](https://camo.githubusercontent.com/2d058aa4937109084c3b00dc259081ef9f01257a8504a292a286041635575d96/68747470733a2f2f76657263656c2e636f6d2f7374617469632f7374617475732f72656164792e737667) [Ready](https://vercel.com/sui-foundation/sui-docs/3umUAZkcPARiaraawcmLwfArg9yw) | [Preview](https://sui-docs-git-indexer-framework-align-firs-f3407c-sui-foundation.vercel.app) | [Comment](https://vercel.live/open-feedback/sui-docs-git-indexer-framework-align-firs-f3407c-sui-foundation.vercel.app?via=pr-comment-feedback-link) | Nov 20, 2025 8:42pm |  2 Skipped Deployments   | Project | Deployment | Preview | Comments | Updated (UTC) | | --- | --- | --- | --- | --- | | [multisig-toolkit](https://vercel.com/mysten-labs/multisig-toolkit) | [Ignored](https://camo.githubusercontent.com/6af980227b4c827b4b58e336e17b2523b7763da7d328256138bdddcbbe31ecbb/68747470733a2f2f76657263656c2e636f6d2f7374617469632f7374617475732f63616e63656c65642e737667) [Ignored](https://vercel.com/mysten-labs/multisig-toolkit/A3mRQ5ofT4dyfWa1knc3Q9vf5Rkj) | [Preview](https://multisig-toolkit-git-indexer-framework-align-25bea0-mysten-labs.vercel.app) |  | Nov 20, 2025 8:42pm | | [sui-kiosk](https://vercel.com/mysten-labs/sui-kiosk) | [Ignored](https://camo.githubusercontent.com/6af980227b4c827b4b58e336e17b2523b7763da7d328256138bdddcbbe31ecbb/68747470733a2f2f76657263656c2e636f6d2f7374617469632f7374617475732f63616e63656c65642e737667) [Ignored](https://vercel.com/mysten-labs/sui-kiosk/BynTdKw9FpjbmynX9YVNzE6Hmb1U) | [Preview](https://sui-kiosk-git-indexer-framework-align-first-da6f9c-mysten-labs.vercel.app) |  | Nov 20, 2025 8:42pm | |

All reactions

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/19120235197/job/54638935872)
to
sui-typescript-aws-kms-test-env
[November 6, 2025 00:05](#event-20744458350) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[force-pushed](/MystenLabs/sui/compare/c9da228d5ea9dc22bfc6c6dc9033b0c423b738d2..1f06f380dbb54b8f731d85642ee816887311d59d)
the

indexer-framework-align-first-checkpoint-usage
branch
from
[`c9da228`](/MystenLabs/sui/commit/c9da228d5ea9dc22bfc6c6dc9033b0c423b738d2) to
[`1f06f38`](/MystenLabs/sui/commit/1f06f380dbb54b8f731d85642ee816887311d59d)  [Compare](/MystenLabs/sui/compare/c9da228d5ea9dc22bfc6c6dc9033b0c423b738d2..1f06f380dbb54b8f731d85642ee816887311d59d)
[November 6, 2025 00:07](#event-20744480692)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/19120268179/job/54639041191)
to
sui-typescript-aws-kms-test-env
[November 6, 2025 00:07](#event-20744481208) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
added
the
[Type: Documentation](/MystenLabs/sui/issues?q=state%3Aopen%20label%3A%22Type%3A%20Documentation%22)
Improvements or additions to documentation
label
[Nov 6, 2025](#event-20744482283)

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-ck60yukb9-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-ck60yukb9-sui-foundation.vercel.app)
[November 6, 2025 00:09](#event-20744508551)
[View deployment](https://sui-docs-ck60yukb9-sui-foundation.vercel.app)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
changed the title
~~remove skip\_watermark, which allows us to standardize how to update t‚Ä¶~~
[indexer-alt-framework] remove skip\_watermark and standardize `first_checkpoint` behavior
[Nov 6, 2025](#event-20744865331)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/19121335193/job/54642340744)
to
sui-typescript-aws-kms-test-env
[November 6, 2025 01:02](#event-20745279768) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-98p8a37su-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-98p8a37su-sui-foundation.vercel.app)
[November 6, 2025 01:04](#event-20745305873)
[View deployment](https://sui-docs-98p8a37su-sui-foundation.vercel.app)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/19121411325/job/54642561066)
to
sui-typescript-aws-kms-test-env
[November 6, 2025 01:06](#event-20745330468) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-8uu07hf4d-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-8uu07hf4d-sui-foundation.vercel.app)
[November 6, 2025 01:08](#event-20745354328)
[View deployment](https://sui-docs-8uu07hf4d-sui-foundation.vercel.app)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
changed the title
~~[indexer-alt-framework] remove skip\_watermark and standardize `first_checkpoint` behavior~~
[indexer-alt-framework] remove `skip_watermark` and standardize `first_checkpoint` behavior
[Nov 6, 2025](#event-20745568473)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[force-pushed](/MystenLabs/sui/compare/deea9bde96096644fc53b72b7886a972d9bb6140..6cc8646b4b24390e2f77e583c8d8730c7f61d6af)
the

indexer-framework-align-first-checkpoint-usage
branch
from
[`deea9bd`](/MystenLabs/sui/commit/deea9bde96096644fc53b72b7886a972d9bb6140) to
[`6cc8646`](/MystenLabs/sui/commit/6cc8646b4b24390e2f77e583c8d8730c7f61d6af)  [Compare](/MystenLabs/sui/compare/deea9bde96096644fc53b72b7886a972d9bb6140..6cc8646b4b24390e2f77e583c8d8730c7f61d6af)
[November 6, 2025 01:31](#event-20745614742)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/19121856384/job/54643825510)
to
sui-typescript-aws-kms-test-env
[November 6, 2025 01:31](#event-20745615540) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
marked this pull request as ready for review
[November 6, 2025 01:31](#event-20745622151)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
requested review from
a team,
[jessiemongeon1](/jessiemongeon1) and
[ronny-mysten](/ronny-mysten)
as [code owners](/MystenLabs/sui/blob/6317899b118451a6cee5a5fb6e67439aae7000da/.github/CODEOWNERS#L20)
[November 6, 2025 01:31](#event-20745622249)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
requested review from
[amnn](/amnn),
[emmazzz](/emmazzz),
[evan-wall-mysten](/evan-wall-mysten),
[henryachen](/henryachen) and
[tpham-mysten](/tpham-mysten)
[November 6, 2025 01:31](#event-20745622314)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/19121868401/job/54643861285)
to
sui-typescript-aws-kms-test-env
[November 6, 2025 01:31](#event-20745622585) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-5gddogqm5-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-5gddogqm5-sui-foundation.vercel.app)
[November 6, 2025 01:33](#event-20745634978)
[View deployment](https://sui-docs-5gddogqm5-sui-foundation.vercel.app)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=80&v=4)](/wlmyng)

Copy link

Contributor

Author

### **[wlmyng](/wlmyng)** commented [Nov 6, 2025](#issuecomment-3494421455)

|  |
| --- |
| [@emmazzz](https://github.com/emmazzz) [@amnn](https://github.com/amnn) this hopefully makes it easier to review the desired behavior involving `--first-checkpoint`.  For each pipeline, we calculate the next checkpoint to ingest as either the checkpoint after its watermark, or if that doesn't exist, then the provided first checkpoint, and if that doesn't exist, then 0 (genesis).  The checkpoint that ingestion starts as is the minimum across all the next checkpoints calculated this way (per-pipeline).  We can remove the consistency checks `first_checkpoint <= committer_watermark` because the ingestion piece will always be the minimum among the next checkpoint to process. |

All reactions

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
mentioned this pull request
[Nov 6, 2025](#ref-pullrequest-3451382841)

[[indexer-alt-framework] watermark tasks
#23737](/MystenLabs/sui/pull/23737)

Merged

7 tasks

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[force-pushed](/MystenLabs/sui/compare/6cc8646b4b24390e2f77e583c8d8730c7f61d6af..9310861294925481d565930bcec46edc6a30c5ec)
the

indexer-framework-align-first-checkpoint-usage
branch
from
[`6cc8646`](/MystenLabs/sui/commit/6cc8646b4b24390e2f77e583c8d8730c7f61d6af) to
[`9310861`](/MystenLabs/sui/commit/9310861294925481d565930bcec46edc6a30c5ec)  [Compare](/MystenLabs/sui/compare/6cc8646b4b24390e2f77e583c8d8730c7f61d6af..9310861294925481d565930bcec46edc6a30c5ec)
[November 12, 2025 18:44](#event-20896029212)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/19308263739/job/55221391658)
to
sui-typescript-aws-kms-test-env
[November 12, 2025 18:44](#event-20896030576) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/19308294894/job/55221502541)
to
sui-typescript-aws-kms-test-env
[November 12, 2025 18:45](#event-20896054176) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[force-pushed](/MystenLabs/sui/compare/7232278587ebc1eb866a6f51172771f10ed1032d..4d8009d7950d6f7ac1e7a77418e83197dc15f014)
the

indexer-framework-align-first-checkpoint-usage
branch
from
[`7232278`](/MystenLabs/sui/commit/7232278587ebc1eb866a6f51172771f10ed1032d) to
[`4d8009d`](/MystenLabs/sui/commit/4d8009d7950d6f7ac1e7a77418e83197dc15f014)  [Compare](/MystenLabs/sui/compare/7232278587ebc1eb866a6f51172771f10ed1032d..4d8009d7950d6f7ac1e7a77418e83197dc15f014)
[November 12, 2025 18:46](#event-20896067875)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/19308317623/job/55221580626)
to
sui-typescript-aws-kms-test-env
[November 12, 2025 18:46](#event-20896068948) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-brqdu21tx-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-brqdu21tx-sui-foundation.vercel.app)
[November 12, 2025 18:48](#event-20896109926)
[View deployment](https://sui-docs-brqdu21tx-sui-foundation.vercel.app)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[force-pushed](/MystenLabs/sui/compare/4d8009d7950d6f7ac1e7a77418e83197dc15f014..35a62e550e6161decac6d8b3b4371bbdf8cc7036)
the

indexer-framework-align-first-checkpoint-usage
branch
from
[`4d8009d`](/MystenLabs/sui/commit/4d8009d7950d6f7ac1e7a77418e83197dc15f014) to
[`35a62e5`](/MystenLabs/sui/commit/35a62e550e6161decac6d8b3b4371bbdf8cc7036)  [Compare](/MystenLabs/sui/compare/4d8009d7950d6f7ac1e7a77418e83197dc15f014..35a62e550e6161decac6d8b3b4371bbdf8cc7036)
[November 12, 2025 19:35](#event-20897050538)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/19309600697/job/55226043922)
to
sui-typescript-aws-kms-test-env
[November 12, 2025 19:36](#event-20897051935) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-584y4n1k7-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-584y4n1k7-sui-foundation.vercel.app)
[November 12, 2025 19:38](#event-20897091571)
[View deployment](https://sui-docs-584y4n1k7-sui-foundation.vercel.app)

[![emmazzz](https://avatars.githubusercontent.com/u/14351986?s=60&v=4)](/emmazzz)

**[emmazzz](/emmazzz)**
approved these changes
[Nov 17, 2025](#pullrequestreview-3470683449)

[View reviewed changes](/MystenLabs/sui/pull/24192/files)

Copy link

Contributor

### @emmazzz **[emmazzz](/emmazzz)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved
 
Hide comment

Looks good to me!  
And I like the simplifications we have done so far: no more `skip_watermarks`, no more different treatments of sequential vs concurrent pipelines wrt first checkpoint, etc. Restricting `first_checkpoint` is good too since the same behavior it enabled can be done with tasks.

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

All reactions

[crates/sui-indexer-alt-framework/src/lib.rs](/MystenLabs/sui/pull/24192/files#diff-d828bd85be0cbba9f1dd6c9e20da42af42915b7f6a0beffa688da153b34d6a6d)

Outdated

|  |  |  |
| --- | --- | --- |
|  |  | let last\_checkpoint = self.last\_checkpoint.unwrap\_or(u64::MAX); |
|  |  |  |
|  |  | info!(first\_checkpoint, last\_checkpoint = ?self.last\_checkpoint, "Ingestion range"); |
|  |  | info!(self.first\_checkpoint\_from\_watermark, last\_checkpoint = ?self.last\_checkpoint, "Ingestion range"); |

Copy link

Contributor

### @emmazzz **[emmazzz](/emmazzz)** [Nov 17, 2025](#discussion_r2532429642)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved
 
Hide comment

I understand we probably call this `first_checkpoint_from_watermark` to distinguish from `first_checkpoint` which is a user-provided arg, but this name seems a bit imprecise because this value might not come from watermarks. It's really just the minimum of `next_checkpoint` across all pipelines. Maybe call it something like `min_next_checkpoint`?

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

All reactions

Copy link

Contributor

### @amnn **[amnn](/amnn)** [Nov 20, 2025](#discussion_r2546856386)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved
 
Hide comment

Maybe it now makes sense to call this field `first_checkpoint` and what we call `first_checkpoint` now should be `default_first_checkpoint` or something? We only need to make this change inside `Indexer` (i.e. it still makes sense to call the flag `--first-checkpoint` even though it ends up populating `default_first_checkpoint`).

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

üëç
1
 wlmyng reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Copy link

Contributor

Author

### @wlmyng **[wlmyng](/wlmyng)** [Nov 20, 2025](#discussion_r2547564178)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved
 
Hide comment

I went with  
`first_checkpoint` -> `default_next_checkpoint`  
`first_checkpoint_from_watermark` -> `first_ingestion_checkpoint`

And modified doc comments

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

üëç
1
 amnn reacted with thumbs up emoji

All reactions

* üëç
  1 reaction







[crates/sui-indexer-alt-framework/src/lib.rs](/MystenLabs/sui/pull/24192/files#diff-d828bd85be0cbba9f1dd6c9e20da42af42915b7f6a0beffa688da153b34d6a6d)

|  |  |  |
| --- | --- | --- |
|  |  | batch.extend(values); |
|  |  | crate::pipeline::concurrent::BatchStatus::Pending |
|  |  | } |
|  |  | macro\_rules! test\_pipeline { |

Copy link

Contributor

### @emmazzz **[emmazzz](/emmazzz)** [Nov 17, 2025](#discussion_r2535011391)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved
 
Hide comment

Good idea adding the macro!

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

üëç
1
 wlmyng reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

[![amnn](https://avatars.githubusercontent.com/u/332275?s=60&v=4)](/amnn)

**[amnn](/amnn)**
approved these changes
[Nov 20, 2025](#pullrequestreview-3488881594)

[View reviewed changes](/MystenLabs/sui/pull/24192/files)

Copy link

Contributor

### @amnn **[amnn](/amnn)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved
 
Hide comment

Nice!

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

All reactions

[crates/sui-indexer-alt-framework/src/lib.rs](/MystenLabs/sui/pull/24192/files#diff-d828bd85be0cbba9f1dd6c9e20da42af42915b7f6a0beffa688da153b34d6a6d)

Outdated

|  |  |  |
| --- | --- | --- |
|  |  | let last\_checkpoint = self.last\_checkpoint.unwrap\_or(u64::MAX); |
|  |  |  |
|  |  | info!(first\_checkpoint, last\_checkpoint = ?self.last\_checkpoint, "Ingestion range"); |
|  |  | info!(self.first\_checkpoint\_from\_watermark, last\_checkpoint = ?self.last\_checkpoint, "Ingestion range"); |

Copy link

Contributor

### @amnn **[amnn](/amnn)** [Nov 20, 2025](#discussion_r2546856386)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved
 
Hide comment

Maybe it now makes sense to call this field `first_checkpoint` and what we call `first_checkpoint` now should be `default_first_checkpoint` or something? We only need to make this change inside `Indexer` (i.e. it still makes sense to call the flag `--first-checkpoint` even though it ends up populating `default_first_checkpoint`).

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

üëç
1
 wlmyng reacted with thumbs up emoji

All reactions

* üëç
  1 reaction







[crates/sui-indexer-alt-framework/src/lib.rs](/MystenLabs/sui/pull/24192/files#diff-d828bd85be0cbba9f1dd6c9e20da42af42915b7f6a0beffa688da153b34d6a6d)

Outdated
 


Show resolved


Hide resolved

### Uh oh!

There was an error while loading. Please reload this page.

[![@amnn](https://avatars.githubusercontent.com/u/332275?s=80&u=fbf218c7e4a657c413a08873087b3f79c535da22&v=4)](/amnn)

Copy link

Contributor

### **[amnn](/amnn)** commented [Nov 20, 2025](#issuecomment-3559318574)

|  |
| --- |
| Don't forget to update the Release Notes to describe the breaking change -- this is potentially a big one for folks who are used to using `--first-checkpoint` + `--last-checkpoint` + `--skip-watermark` for backfills.  We should write a little explainer for this to share with the community when we land the change. |

üëç
1
 wlmyng reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

### Uh oh!

There was an error while loading. Please reload this page.

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)

`remove skip_watermark, which allows us to standardize how to update t‚Ä¶`

 ‚Ä¶

`63392a6`

```move
‚Ä¶he starting ingestion checkpoint, and each pipeline's checkpoint to start processing from. rework tests, and remove --skip-watermark from doc
```

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[force-pushed](/MystenLabs/sui/compare/35a62e550e6161decac6d8b3b4371bbdf8cc7036..63392a68e03cbbfa7704acb78fee9aa6eb77f8e0)
the

indexer-framework-align-first-checkpoint-usage
branch
from
[`35a62e5`](/MystenLabs/sui/commit/35a62e550e6161decac6d8b3b4371bbdf8cc7036) to
[`63392a6`](/MystenLabs/sui/commit/63392a68e03cbbfa7704acb78fee9aa6eb77f8e0)  [Compare](/MystenLabs/sui/compare/35a62e550e6161decac6d8b3b4371bbdf8cc7036..63392a68e03cbbfa7704acb78fee9aa6eb77f8e0)
[November 20, 2025 20:36](#event-21081020890)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
[temporarily deployed](https://github.com/MystenLabs/sui/actions/runs/19550604847/job/55980817249)
to
sui-typescript-aws-kms-test-env
[November 20, 2025 20:36](#event-21081022221) ‚Äî with ![](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)
[GitHub Actions](https://github.com/apps/github-actions)

Inactive

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://sui-docs-rccdo0o77-sui-foundation.vercel.app "Deployment has completed")
to
[Preview ‚Äì sui-docs](https://sui-docs-rccdo0o77-sui-foundation.vercel.app)
[November 20, 2025 20:42](#event-21081109209)
[View deployment](https://sui-docs-rccdo0o77-sui-foundation.vercel.app)

Hide details
View details
[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
merged commit [`683c83b`](/MystenLabs/sui/commit/683c83b5f205d31c633f38af25251e64459fdaa8)
into

main
[Nov 24, 2025](https://github.com/MystenLabs/sui/pull/24192#event-21151493811)

57 checks passed

### Uh oh!

There was an error while loading. Please reload this page.

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)
[wlmyng](/wlmyng)
deleted the

indexer-framework-align-first-checkpoint-usage
 
branch
[November 24, 2025 23:53](#event-21151494766)

[wlmyng](/wlmyng)
added a commit
that referenced
this pull request
[Nov 25, 2025](#ref-commit-75e461e)

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=40&v=4)](/wlmyng)

`[indexer-alt-framework] watermark tasks (#23737)`

‚Ä¶

`75e461e`

```move
## Description 

Building on #24192, we now have
new fields `--task` and `--reader-interval-ms`, which when set creates
an indexer whose pipelines commit checkpoint data as long as it is not
less than each of its main pipeline's `pruner_hi`.

Startup behavior remains the same as defined in the previous PR: all
pipelines, tasked or not, will resume committing from next after its
committer watermark, or expect 0, unless overridden by
`--first-checkpoint`.

The indexer determines ingestion as the smallest next checkpoint across
pipelines (as calculated above.)

To backfill, operators either:
- run a new indexer with `-task` and `-first-checkpoint` (preferred), or
- wipe watermark entries for main pipelines (without task) and restart
main indexer with `-first-checkpoint.`

Multiple tasked indexers can run in parallel with different ranges to
accelerate backfill.


## Test plan 

New tests in `lib.rs` and `collector.rs`

Additional tests in `collector`

---

## Release notes

Check each box that your changes affect. If none of the boxes relate to
your changes, release notes aren't required.

For each box you select, include information after the relevant heading
that describes the impact of your changes that a user might notice and
any actions they must take to implement updates.

- [ ] Protocol: 
- [ ] Nodes (Validators and Full nodes): 
- [ ] gRPC:
- [x] JSON-RPC: 
This PR, in tandem
with¬†[https://github.com/MystenLabs/sui/pull/24192](https://github.com/MystenLabs/sui/pull/24192),
unifies how indexers determine their ingestion starting point and
introduce watermark-gated backfill tasks.

1. `--skip-watermark`¬†is removed, and the previous ability to bypass
watermark safety checks for concurrent pipelines is no longer supported.
2. `--first-checkpoint`¬†no longer forces the indexer to start ingesting
from the configured checkpoint. The indexer now always determines its
starting ingestion point as the minimum next checkpoint across all
pipelines to resume processing from. From this release,
`--first-checkpoint` now only applies to pipelines that do not yet have
a committer watermark. These pipelines will resume processing from the
configured value. Pipelines with existing watermarks will always resume
processing from their own next checkpoint.
3. A new mechanism, watermark tasks, allows operators to run the same
pipelines on multiple indexer instances for historical backfilling. Two
new flags,¬†`--task`¬†and¬†`--reader-interval-ms`, enable this mechanism.
These flags create a tasked indexer whose pipelines commit checkpoint
data as long as the checkpoint is not below the¬†`reader_lo`¬†watermark of
their corresponding main pipelines. The indexer controls how frequently
these tasked pipelines poll the main pipelines' watermarks
per¬†`--reader-interval-ms`.

Migration guidance:  
1. If you use¬†`--first-checkpoint`¬†only for¬†_initial_¬†ingestion of a
fresh pipeline, no further action is needed.
2. If you previously used¬†`--first-checkpoint`¬†and
optionally¬†`--skip-watermark`¬†to backfill existing tables, you can
achieve the same workflow by starting a new indexer instance with a
configured¬†`--task`,¬†`--reader-interval-ms`, and¬†`--first-checkpoint`.
3. Like¬†`--skip-watermark`,¬†`--task`¬†cannot be used to run sequential
pipelines.
- [x] GraphQL: 
See above
- [ ] CLI: 
- [ ] Rust SDK:
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FMystenLabs%2Fsui%2Fpull%2F24192)

### Reviewers

[![@amnn](https://avatars.githubusercontent.com/u/332275?s=40&v=4)](/amnn) [amnn](/amnn)

amnn approved these changes

[![@emmazzz](https://avatars.githubusercontent.com/u/14351986?s=40&v=4)](/emmazzz) [emmazzz](/emmazzz)

emmazzz approved these changes

[![@ronny-mysten](https://avatars.githubusercontent.com/u/118224482?s=40&v=4)](/ronny-mysten) [ronny-mysten](/ronny-mysten)






 Awaiting requested review from ronny-mysten

[![@jessiemongeon1](https://avatars.githubusercontent.com/u/133128541?s=40&v=4)](/jessiemongeon1) [jessiemongeon1](/jessiemongeon1)






 Awaiting requested review from jessiemongeon1






 jessiemongeon1 is a code owner

[![@henryachen](https://avatars.githubusercontent.com/u/8963934?s=40&v=4)](/henryachen) [henryachen](/henryachen)






 Awaiting requested review from henryachen






 henryachen is a code owner automatically assigned from MystenLabs/devx-indexers-and-rpcs

[![@tpham-mysten](https://avatars.githubusercontent.com/u/214580142?s=40&v=4)](/tpham-mysten) [tpham-mysten](/tpham-mysten)






 Awaiting requested review from tpham-mysten






 tpham-mysten is a code owner automatically assigned from MystenLabs/devx-indexers-and-rpcs

[![@evan-wall-mysten](https://avatars.githubusercontent.com/u/219740240?s=40&v=4)](/evan-wall-mysten) [evan-wall-mysten](/evan-wall-mysten)






 Awaiting requested review from evan-wall-mysten






 evan-wall-mysten is a code owner automatically assigned from MystenLabs/devx-indexers-and-rpcs

### Assignees

No one assigned

### Labels

[Type: Documentation](/MystenLabs/sui/issues?q=state%3Aopen%20label%3A%22Type%3A%20Documentation%22)
Improvements or additions to documentation

### Projects

None yet

### Milestone

No milestone

### Development

Successfully merging this pull request may close these issues.

### Uh oh!

There was an error while loading. Please reload this page.

### 4 participants

[![@wlmyng](https://avatars.githubusercontent.com/u/127570466?s=52&v=4)](/wlmyng) [![@amnn](https://avatars.githubusercontent.com/u/332275?s=52&v=4)](/amnn) [![@emmazzz](https://avatars.githubusercontent.com/u/14351986?s=52&v=4)](/emmazzz)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

You can‚Äôt perform that action at this time.